<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ode.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a href="http://www.alsprogrammingresource.com"><img src="../../../../images/als_programming_resource.jpg" alt="Al's Programming Resource Homepage" align="middle" border=0 width=88 height=31 /></a>&nbsp;<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ode.cpp</h1><a href="ode_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*************************************************************************</font>
00002 <font class="comment"> *                                                                       *</font>
00003 <font class="comment"> * Open Dynamics Engine, Copyright (C) 2001-2003 Russell L. Smith.       *</font>
00004 <font class="comment"> * All rights reserved.  Email: russ@q12.org   Web: www.q12.org          *</font>
00005 <font class="comment"> *                                                                       *</font>
00006 <font class="comment"> * This library is free software; you can redistribute it and/or         *</font>
00007 <font class="comment"> * modify it under the terms of EITHER:                                  *</font>
00008 <font class="comment"> *   (1) The GNU Lesser General Public License as published by the Free  *</font>
00009 <font class="comment"> *       Software Foundation; either version 2.1 of the License, or (at  *</font>
00010 <font class="comment"> *       your option) any later version. The text of the GNU Lesser      *</font>
00011 <font class="comment"> *       General Public License is included with this library in the     *</font>
00012 <font class="comment"> *       file LICENSE.TXT.                                               *</font>
00013 <font class="comment"> *   (2) The BSD-style license that is included with this library in     *</font>
00014 <font class="comment"> *       the file LICENSE-BSD.TXT.                                       *</font>
00015 <font class="comment"> *                                                                       *</font>
00016 <font class="comment"> * This library is distributed in the hope that it will be useful,       *</font>
00017 <font class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of        *</font>
00018 <font class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the files    *</font>
00019 <font class="comment"> * LICENSE.TXT and LICENSE-BSD.TXT for more details.                     *</font>
00020 <font class="comment"> *                                                                       *</font>
00021 <font class="comment"> *************************************************************************/</font>
00022 
00023 <font class="preprocessor">#include &lt;windows.h&gt;</font>
00024 <font class="preprocessor">#include &lt;gl/gl.h&gt;</font>
00025 <font class="preprocessor">#include &lt;gl/glu.h&gt;</font>
00026 <font class="preprocessor">#include &lt;<a class="code" href="ode_8h.html">ode/ode.h</a>&gt;</font>
00027 <font class="preprocessor">#include "<a class="code" href="camera_8h.html">camera.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="ode_8h.html">ode.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="console_8h.html">console.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="matrix_8h.html">matrix.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">texture.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="general_8h.html">general.h</a>"</font>
00033 
00034 <font class="keyword">using</font> <font class="keyword">namespace </font>std;
00035 
<a name="l00036"></a><a class="code" href="ode_8cpp.html#a0">00036</a> <font class="keyword">extern</font> <a class="code" href="classMATRIX.html">MATRIX</a> <a class="code" href="ode_8cpp.html#a0">GeomMatrix</a>;
<a name="l00037"></a><a class="code" href="ode_8cpp.html#a1">00037</a> <font class="keyword">extern</font> <a class="code" href="classTEXTURE.html">TEXTURE</a> * <a class="code" href="ode_8cpp.html#a1">texture</a>;
00038 
00039 <font class="comment">// dynamics and collision objects</font>
<a name="l00040"></a><a class="code" href="ode_8cpp.html#a2">00040</a> <font class="keyword">extern</font> dWorldID <a class="code" href="ode_8cpp.html#a2">World</a>;             <font class="comment">// the ode simulation world </font>
<a name="l00041"></a><a class="code" href="ode_8cpp.html#a3">00041</a> <font class="keyword">extern</font> dSpaceID <a class="code" href="ode_8cpp.html#a3">Space</a>;             <font class="comment">// collision space</font>
<a name="l00042"></a><a class="code" href="ode_8cpp.html#a4">00042</a> <font class="keyword">extern</font> <a class="code" href="structMyObject.html">MyObject</a> <a class="code" href="ode_8cpp.html#a4">Object</a>;            <font class="comment">// geom object</font>
<a name="l00043"></a><a class="code" href="ode_8cpp.html#a5">00043</a> <font class="keyword">extern</font> dJointGroupID <a class="code" href="ode_8cpp.html#a5">contactgroup</a>; <font class="comment">// contact group for collisions</font>
00044 
00045 <font class="comment">// this is called by dSpaceCollide when two objects in space are</font>
00046 <font class="comment">// potentially colliding.</font>
<a name="l00047"></a><a class="code" href="ode_8cpp.html#a6">00047</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="ode_8cpp.html#a6">nearCallback</a>(<font class="keywordtype">void</font> *data, dGeomID o1, dGeomID o2)
00048 {
00049     <font class="keywordtype">int</font> i;
00050 
00051     dBodyID b1 = dGeomGetBody(o1);
00052     dBodyID b2 = dGeomGetBody(o2);
00053 
00054     dContact contact[<a class="code" href="ode_8h.html#a2">MAX_CONTACTS</a>];   <font class="comment">// up to MAX_CONTACTS contacts per box-box</font>
00055 
00056     <font class="keywordflow">for</font> (i = 0; i &lt; <a class="code" href="ode_8h.html#a2">MAX_CONTACTS</a>; i++)
00057     {
00058         contact[i].surface.mode = dContactBounce | dContactSoftCFM;
00059         contact[i].surface.mu = dInfinity;
00060         contact[i].surface.mu2 = 0;
00061         contact[i].surface.bounce = 0.01;
00062         contact[i].surface.bounce_vel = 0.1;
00063         contact[i].surface.soft_cfm = 0.01;
00064     }
00065 
00066     <font class="keywordflow">if</font> (<font class="keywordtype">int</font> numc = dCollide(o1, o2, <a class="code" href="ode_8h.html#a2">MAX_CONTACTS</a>, &amp;contact[0].geom, <font class="keyword">sizeof</font>(dContact)))
00067     {
00068         <font class="keywordflow">for</font> (i = 0; i &lt; numc; i++)
00069         {
00070             dJointID c = dJointCreateContact(<a class="code" href="ode_8cpp.html#a2">World</a>, <a class="code" href="ode_8cpp.html#a5">contactgroup</a>, contact + i);
00071             dJointAttach(c, b1, b2);
00072         }
00073     }
00074 }
00075 
00076 <font class="comment">// Draw a geom</font>
<a name="l00077"></a><a class="code" href="ode_8cpp.html#a7">00077</a> <font class="keywordtype">void</font> <a class="code" href="ode_8cpp.html#a7">DrawGeom</a>(dGeomID g, <font class="keyword">const</font> dReal *pos, <font class="keyword">const</font> dReal *R, <font class="keywordtype">int</font> show_aabb)
00078 {
00079     <font class="keywordflow">if</font> (!g)
00080         <font class="keywordflow">return</font>;
00081     <font class="keywordflow">if</font> (!pos)
00082         pos = dGeomGetPosition(g);
00083     <font class="keywordflow">if</font> (!R)
00084         R = dGeomGetRotation(g);
00085 
00086     <font class="keywordtype">int</font> type = dGeomGetClass(g);
00087     <font class="keywordflow">if</font> (type == dBoxClass)
00088     {
00089         dReal sides[3];
00090         dGeomBoxGetLengths(g, sides);
00091         <a class="code" href="general_8h.html#a9">DrawBox</a>(sides, pos, R);        <font class="comment">// included in general.cpp</font>
00092     }
00093 }
00094 
00095 <font class="comment">// Simulation loop</font>
<a name="l00096"></a><a class="code" href="ode_8cpp.html#a8">00096</a> <font class="keywordtype">void</font> <a class="code" href="ode_8cpp.html#a8">SimLoop</a>()
00097 {
00098     dSpaceCollide(<a class="code" href="ode_8cpp.html#a3">Space</a>, 0, &amp;<a class="code" href="ode_8cpp.html#a6">nearCallback</a>);
00099     dWorldQuickStep(<a class="code" href="ode_8cpp.html#a2">World</a>, 0.05);
00100     dJointGroupEmpty(<a class="code" href="ode_8cpp.html#a5">contactgroup</a>);
00101     <a class="code" href="ode_8cpp.html#a7">DrawGeom</a>(Object.<a class="code" href="structMyObject.html#m1">Geom</a>[0], 0, 0, 0);
00102 }
00103 
<a name="l00104"></a><a class="code" href="ode_8cpp.html#a9">00104</a> <font class="keywordtype">void</font> <a class="code" href="ode_8cpp.html#a9">InitODE</a>()
00105 {
00106     <a class="code" href="ode_8cpp.html#a2">World</a> = dWorldCreate();
00107     <a class="code" href="ode_8cpp.html#a3">Space</a> = dHashSpaceCreate(0);
00108     <a class="code" href="ode_8cpp.html#a5">contactgroup</a> = dJointGroupCreate(0);
00109     dCreatePlane(<a class="code" href="ode_8cpp.html#a3">Space</a>, 0, 1, 0, 0);
00110     dWorldSetGravity(<a class="code" href="ode_8cpp.html#a2">World</a>, 0, -1.0, 0);
00111     dWorldSetCFM(<a class="code" href="ode_8cpp.html#a2">World</a>, 1e-5);
00112     dWorldSetERP(<a class="code" href="ode_8cpp.html#a2">World</a>, 0.2);
00113     dWorldSetContactMaxCorrectingVel(<a class="code" href="ode_8cpp.html#a2">World</a>, 0.9);
00114     dWorldSetContactSurfaceLayer(<a class="code" href="ode_8cpp.html#a2">World</a>, 0);
00115     dWorldSetAutoDisableFlag(<a class="code" href="ode_8cpp.html#a2">World</a>, 1);
00116 
00117     size_t i = 0;
00118     dReal sides[3];
00119     dMass m;
00120 
00121     Object.<a class="code" href="structMyObject.html#m0">Body</a> = dBodyCreate(<a class="code" href="ode_8cpp.html#a2">World</a>);
00122 
00123     sides[0] = 2.0;
00124     sides[1] = 2.0;
00125     sides[2] = 2.0;
00126 
00127     dMatrix3 R;
00128     dBodySetPosition(Object.<a class="code" href="structMyObject.html#m0">Body</a>, 0, 10, -5);
00129     <a class="code" href="classVECTOR.html">VECTOR</a> tempVect(0.0, 0.0, 0.0);
00130     dBodySetLinearVel(Object.<a class="code" href="structMyObject.html#m0">Body</a>, tempVect.<a class="code" href="classVECTOR.html#m0">x</a>, tempVect.<a class="code" href="classVECTOR.html#m1">y</a>, tempVect.<a class="code" href="classVECTOR.html#m2">z</a>);
00131     dRFromAxisAndAngle(R, dRandReal() * 2.0 - 1.0, dRandReal() * 2.0 - 1.0, dRandReal() * 2.0 - 1.0, dRandReal() * 10.0 - 5.0);
00132     dBodySetRotation(Object.<a class="code" href="structMyObject.html#m0">Body</a>, R);
00133     dBodySetData(Object.<a class="code" href="structMyObject.html#m0">Body</a>, (<font class="keywordtype">void</font>*)i);
00134     dMassSetBox(&amp;m, <a class="code" href="ode_8h.html#a0">DENSITY</a>, sides[0], sides[1], sides[2]);
00135     Object.<a class="code" href="structMyObject.html#m1">Geom</a>[0] = dCreateBox(<a class="code" href="ode_8cpp.html#a3">Space</a>, sides[0], sides[1], sides[2]);
00136     dGeomSetBody(Object.<a class="code" href="structMyObject.html#m1">Geom</a>[0], Object.<a class="code" href="structMyObject.html#m0">Body</a>);
00137     dBodySetMass(Object.<a class="code" href="structMyObject.html#m0">Body</a>, &amp;m);
00138 }
00139 
<a name="l00140"></a><a class="code" href="ode_8cpp.html#a10">00140</a> <font class="keywordtype">void</font> <a class="code" href="ode_8cpp.html#a10">CloseODE</a>()
00141 {
00142     dJointGroupDestroy(<a class="code" href="ode_8cpp.html#a5">contactgroup</a>);
00143     dSpaceDestroy(<a class="code" href="ode_8cpp.html#a3">Space</a>);
00144     dWorldDestroy(<a class="code" href="ode_8cpp.html#a2">World</a>);
00145 }
</pre></div><hr><address align="right"><small>Generated on Thu Feb 9 04:21:44 2006 for Basic ODE Example by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
