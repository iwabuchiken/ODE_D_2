<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>main.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a href="http://www.alsprogrammingresource.com"><img src="../../../../images/als_programming_resource.jpg" alt="Al's Programming Resource Homepage" align="middle" border=0 width=88 height=31 /></a>&nbsp;<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>main.cpp</h1><a href="main_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// ~~~ OpenGL &amp; Win32 ~~~</font>
00002 <font class="comment">// Tutorial No.24 - ODE Physics</font>
00003 <font class="comment">// Alan Baylis 2006</font>
00004 
00005 <font class="preprocessor">#include &lt;windows.h&gt;</font>
00006 <font class="preprocessor">#include &lt;<a class="code" href="ode_8h.html">ode/ode.h</a>&gt;</font>    <font class="comment">// ode library header</font>
00007 <font class="preprocessor">#include "<a class="code" href="shared_8h.html">shared.h</a>"</font>
00008 <font class="preprocessor">#include "<a class="code" href="general_8h.html">general.h</a>"</font>
00009 <font class="preprocessor">#include "<a class="code" href="vector_8h.html">vector.h</a>"</font>
00010 <font class="preprocessor">#include "<a class="code" href="vertex_8h.html">vertex.h</a>"</font>
00011 <font class="preprocessor">#include "<a class="code" href="quat_8h.html">quat.h</a>"</font>
00012 <font class="preprocessor">#include "<a class="code" href="matrix_8h.html">matrix.h</a>"</font>
00013 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">texture.h</a>"</font>
00014 <font class="preprocessor">#include "<a class="code" href="locmath_8h.html">locmath.h</a>"</font>
00015 <font class="preprocessor">#include "<a class="code" href="polygon_8h.html">polygon.h</a>"</font>
00016 <font class="preprocessor">#include "<a class="code" href="object_8h.html">object.h</a>"</font>
00017 <font class="preprocessor">#include "<a class="code" href="camera_8h.html">camera.h</a>"</font>
00018 <font class="preprocessor">#include "<a class="code" href="light_8h.html">light.h</a>"</font>
00019 <font class="preprocessor">#include "<a class="code" href="collision_8h.html">collision.h</a>"</font>
00020 <font class="preprocessor">#include "<a class="code" href="winfuncs_8h.html">winfuncs.h</a>"</font>
00021 <font class="preprocessor">#include "<a class="code" href="timer_8h.html">timer.h</a>"</font>      <font class="comment">// replaced the old GetTickCount timer</font>
00022 <font class="preprocessor">#include "<a class="code" href="ode_8h.html">ode.h</a>"</font>        <font class="comment">// ode related functions</font>
00023 <font class="preprocessor">#include "<a class="code" href="console_8h.html">console.h</a>"</font>
00024 <font class="preprocessor">#include "<a class="code" href="resource_8h.html">resource.h</a>"</font>
00025 
00026 <font class="comment">// ODE Physics</font>
<a name="l00027"></a><a class="code" href="main_8cpp.html#a0">00027</a> <a class="code" href="classMATRIX.html">MATRIX</a> <a class="code" href="main_8cpp.html#a0">GeomMatrix</a>;          <font class="comment">// transformation matrix for geom rendering</font>
<a name="l00028"></a><a class="code" href="main_8cpp.html#a1">00028</a> dWorldID <a class="code" href="main_8cpp.html#a1">World</a>;             <font class="comment">// the ode simulation world </font>
<a name="l00029"></a><a class="code" href="main_8cpp.html#a2">00029</a> dSpaceID <a class="code" href="main_8cpp.html#a2">Space</a>;             <font class="comment">// collision space</font>
<a name="l00030"></a><a class="code" href="main_8cpp.html#a3">00030</a> <a class="code" href="structMyObject.html">MyObject</a> <a class="code" href="main_8cpp.html#a3">Object</a>;            <font class="comment">// one geom object</font>
<a name="l00031"></a><a class="code" href="main_8cpp.html#a4">00031</a> dJointGroupID <a class="code" href="main_8cpp.html#a4">contactgroup</a>; <font class="comment">// contact group for collisions</font>
00032 
00033 <font class="comment">// Windows</font>
<a name="l00034"></a><a class="code" href="main_8cpp.html#a5">00034</a> <font class="keyword">static</font> HGLRC <a class="code" href="main_8cpp.html#a5">hRC</a>;
<a name="l00035"></a><a class="code" href="main_8cpp.html#a6">00035</a> <font class="keyword">static</font> HDC <a class="code" href="main_8cpp.html#a6">hDC</a>;
<a name="l00036"></a><a class="code" href="main_8cpp.html#a7">00036</a> HWND <a class="code" href="main_8cpp.html#a7">hWnd</a>;
<a name="l00037"></a><a class="code" href="main_8cpp.html#a8">00037</a> RECT <a class="code" href="main_8cpp.html#a8">screen</a>;
<a name="l00038"></a><a class="code" href="main_8cpp.html#a9">00038</a> PAINTSTRUCT <a class="code" href="main_8cpp.html#a9">ps</a>;
00039 
00040 <font class="comment">// Math</font>
<a name="l00041"></a><a class="code" href="main_8cpp.html#a10">00041</a> <font class="keywordtype">float</font> <a class="code" href="main_8cpp.html#a10">pi</a> = 3.141592;
<a name="l00042"></a><a class="code" href="main_8cpp.html#a11">00042</a> <font class="keywordtype">float</font> <a class="code" href="main_8cpp.html#a11">radian</a> = <a class="code" href="main_8cpp.html#a10">pi</a> / 180;
<a name="l00043"></a><a class="code" href="main_8cpp.html#a12">00043</a> <font class="keywordtype">float</font> <a class="code" href="main_8cpp.html#a12">epsilon</a> = 0.05;       <font class="comment">// minimum collision distance</font>
00044 
00045 <font class="comment">// Input</font>
<a name="l00046"></a><a class="code" href="main_8cpp.html#a13">00046</a> <font class="keywordtype">bool</font> <a class="code" href="main_8cpp.html#a13">key</a>[256];
<a name="l00047"></a><a class="code" href="main_8cpp.html#a14">00047</a> <font class="keywordtype">bool</font> <a class="code" href="main_8cpp.html#a14">released_key</a>[256];
00048 
00049 <font class="comment">// Cameras</font>
<a name="l00050"></a><a class="code" href="main_8cpp.html#a15">00050</a> <font class="keywordtype">int</font> <a class="code" href="main_8cpp.html#a15">currentCamera</a> = 0;
<a name="l00051"></a><a class="code" href="main_8cpp.html#a16">00051</a> <font class="keywordtype">int</font> <a class="code" href="main_8cpp.html#a16">numCameras</a> = 4;
<a name="l00052"></a><a class="code" href="main_8cpp.html#a17">00052</a> <font class="keywordtype">float</font> <a class="code" href="main_8cpp.html#a17">step</a> = 5.0;
00053 
00054 <font class="comment">// Timing</font>
<a name="l00055"></a><a class="code" href="main_8cpp.html#a18">00055</a> <a class="code" href="classTimer.html">Timer</a>* <a class="code" href="main_8cpp.html#a18">MyTimer</a> = <font class="keyword">new</font> <a class="code" href="classTimer.html">Timer</a>;
<a name="l00056"></a><a class="code" href="main_8cpp.html#a19">00056</a> <font class="keywordtype">double</font> <a class="code" href="main_8cpp.html#a19">multiplier</a>;
00057 
00058 <font class="comment">// Lights</font>
<a name="l00059"></a><a class="code" href="main_8cpp.html#a20">00059</a> <font class="keywordtype">int</font> <a class="code" href="main_8cpp.html#a20">GL_LIGHT</a>[8] = {GL_LIGHT0, GL_LIGHT1, GL_LIGHT2, GL_LIGHT3, GL_LIGHT4, GL_LIGHT5, GL_LIGHT6, GL_LIGHT7};    <font class="comment">// Represent GL lights in a conveniant array</font>
<a name="l00060"></a><a class="code" href="main_8cpp.html#a21">00060</a> <font class="keywordtype">int</font> <a class="code" href="main_8cpp.html#a21">currentLight</a> = 0;
<a name="l00061"></a><a class="code" href="main_8cpp.html#a22">00061</a> <font class="keywordtype">int</font> <a class="code" href="main_8cpp.html#a22">numLights</a> = 0;
00062 
00063 <font class="comment">// Cube polygons</font>
<a name="l00064"></a><a class="code" href="main_8cpp.html#a23">00064</a> <a class="code" href="classPOLYGON.html">POLYGON</a> * <a class="code" href="main_8cpp.html#a23">polygon</a> = <font class="keyword">new</font> <a class="code" href="classPOLYGON.html">POLYGON</a>[12];
00065 
00066 <font class="comment">// Texture</font>
<a name="l00067"></a><a class="code" href="main_8cpp.html#a24">00067</a> <a class="code" href="classTEXTURE.html">TEXTURE</a> * <a class="code" href="main_8cpp.html#a24">texture</a> = <font class="keyword">new</font> <a class="code" href="classTEXTURE.html">TEXTURE</a>[1];
00068 
00069 <font class="comment">// Camera</font>
<a name="l00070"></a><a class="code" href="main_8cpp.html#a25">00070</a> <a class="code" href="classCAMERA.html">CAMERA</a> * <a class="code" href="main_8cpp.html#a25">camera</a> = <font class="keyword">new</font> <a class="code" href="classCAMERA.html">CAMERA</a>[<a class="code" href="main_8cpp.html#a16">numCameras</a> + 1];
00071 
00072 <font class="comment">// Lighting</font>
<a name="l00073"></a><a class="code" href="main_8cpp.html#a26">00073</a> <a class="code" href="classLIGHT.html">LIGHT</a> * <a class="code" href="main_8cpp.html#a26">light</a> = <font class="keyword">new</font> <a class="code" href="classLIGHT.html">LIGHT</a>[<a class="code" href="main_8cpp.html#a22">numLights</a> + 1];
<a name="l00074"></a><a class="code" href="main_8cpp.html#a27">00074</a> <font class="keywordtype">float</font> <a class="code" href="main_8cpp.html#a27">lightColor</a>[3] = {1.0, 1.0, 1.0};
00075 
00076 <font class="comment">// Dialogs</font>
<a name="l00077"></a><a class="code" href="main_8cpp.html#a28">00077</a> <font class="keywordtype">int</font> <a class="code" href="main_8cpp.html#a28">DialogInUse</a> = 0;
00078 
00079 <font class="comment">// Console</font>
<a name="l00080"></a><a class="code" href="main_8cpp.html#a29">00080</a> <a class="code" href="classConsoleWindow.html">ConsoleWindow</a> * <a class="code" href="main_8cpp.html#a29">Console</a> = <font class="keyword">new</font> <a class="code" href="classConsoleWindow.html">ConsoleWindow</a>;
00081 
<a name="l00082"></a><a class="code" href="main_8cpp.html#a30">00082</a> <font class="keywordtype">void</font> <a class="code" href="main_8cpp.html#a30">InitGL</a>(<font class="keywordtype">int</font> Width, <font class="keywordtype">int</font> Height)
00083 {
00084     <a class="code" href="ode_8cpp.html#a9">InitODE</a>();             <font class="comment">// Initalize the ODE simulation</font>
00085     <a class="code" href="general_8cpp.html#a9">SetGLProperties</a>();
00086     <a class="code" href="general_8cpp.html#a12">SetGLMaterial</a>();
00087     <a class="code" href="general_8cpp.html#a11">SetGLView</a>(Width, Height);
00088     <a class="code" href="general_8cpp.html#a6">SetGLLighting</a>(light);
00089     <a class="code" href="general_8cpp.html#a8">SetGLWorld</a>(polygon);
00090     <a class="code" href="general_8cpp.html#a13">SetGLTexture</a>(texture);
00091     <a class="code" href="general_8cpp.html#a7">SetGLCamera</a>(camera);    
00092 }
00093 
<a name="l00094"></a><a class="code" href="main_8cpp.html#a31">00094</a> <font class="keywordtype">void</font> <a class="code" href="main_8cpp.html#a31">ReSizeGLScene</a>(<font class="keywordtype">int</font> Width, <font class="keywordtype">int</font> Height)
00095 {
00096     <a class="code" href="general_8cpp.html#a11">SetGLView</a>(Width, Height);
00097 }
00098 
<a name="l00099"></a><a class="code" href="main_8cpp.html#a32">00099</a> <font class="keywordtype">void</font> <a class="code" href="main_8cpp.html#a32">DrawGLScene</a>(<font class="keywordtype">void</font>)
00100 {
00101     glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
00102 
00103     camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Update();
00104     <font class="comment">// Collision detection goes here</font>
00105     camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Apply();
00106 
00107     <font class="keywordtype">int</font> loop;
00108     <font class="keywordflow">for</font>(loop = 0; loop &lt;= <a class="code" href="main_8cpp.html#a22">numLights</a>; loop++)
00109         light[loop].<a class="code" href="classLIGHT.html#a4">Apply</a>();
00110 
00111     <a class="code" href="general_8cpp.html#a14">DrawGrid</a>();
00112 
00113     <a class="code" href="ode_8cpp.html#a8">SimLoop</a>();   <font class="comment">// Step the simulation last</font>
00114 }
00115 
<a name="l00116"></a><a class="code" href="main_8cpp.html#a33">00116</a> LRESULT CALLBACK <a class="code" href="main_8cpp.html#a33">WndProc</a>( HWND    <a class="code" href="main_8cpp.html#a7">hWnd</a>,
00117                           UINT    message,
00118                           WPARAM    wParam,
00119                           LPARAM    lParam)
00120 {
00121     GLuint    PixelFormat;
00122     <font class="keyword">static</font>    PIXELFORMATDESCRIPTOR pfd=
00123     {
00124         <font class="keyword">sizeof</font>(PIXELFORMATDESCRIPTOR),
00125         1,
00126         PFD_DRAW_TO_WINDOW |
00127         PFD_SUPPORT_OPENGL |
00128         PFD_DOUBLEBUFFER,
00129         PFD_TYPE_RGBA,
00130         16,
00131         0, 0, 0, 0, 0, 0,
00132         0,
00133         0,
00134         0,
00135         0, 0, 0, 0,
00136         16,
00137         0,
00138         0,
00139         PFD_MAIN_PLANE,
00140         0,
00141         0, 0, 0
00142     };
00143 
00144 
00145     <font class="keywordflow">switch</font> (message)
00146     {
00147         <font class="keywordflow">case</font> WM_CREATE:
00148             <a class="code" href="main_8cpp.html#a6">hDC</a> = GetDC(<a class="code" href="main_8cpp.html#a7">hWnd</a>);
00149 
00150             PixelFormat = ChoosePixelFormat(<a class="code" href="main_8cpp.html#a6">hDC</a>, &amp;pfd);
00151 
00152             <font class="keywordflow">if</font> (!PixelFormat)
00153             {
00154                 MessageBox(NULL,<font class="stringliteral">"Can't find a suitable PixelFormat."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00155                 PostQuitMessage(0);
00156                 <font class="keywordflow">break</font>;
00157             }
00158 
00159             <font class="keywordflow">if</font>(!SetPixelFormat(<a class="code" href="main_8cpp.html#a6">hDC</a>,PixelFormat,&amp;pfd))
00160             {
00161                 MessageBox(NULL,<font class="stringliteral">"Can't set the PixelFormat."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00162                 PostQuitMessage(0);
00163                 <font class="keywordflow">break</font>;
00164             }
00165 
00166             <a class="code" href="main_8cpp.html#a5">hRC</a> = wglCreateContext(<a class="code" href="main_8cpp.html#a6">hDC</a>);
00167             <font class="keywordflow">if</font>(!<a class="code" href="main_8cpp.html#a5">hRC</a>)
00168             {
00169                 MessageBox(NULL,<font class="stringliteral">"Can't create a GL Rendering Context."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00170                 PostQuitMessage(0);
00171                 <font class="keywordflow">break</font>;
00172             }
00173 
00174             <font class="keywordflow">if</font>(!wglMakeCurrent(<a class="code" href="main_8cpp.html#a6">hDC</a>, <a class="code" href="main_8cpp.html#a5">hRC</a>))
00175             {
00176                 MessageBox(NULL,<font class="stringliteral">"Can't activate the GL Rendering Context."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00177                 PostQuitMessage(0);
00178                 <font class="keywordflow">break</font>;
00179             }
00180 
00181             <a class="code" href="main_8cpp.html#a30">InitGL</a>(<a class="code" href="main_8cpp.html#a8">screen</a>.right, <a class="code" href="main_8cpp.html#a8">screen</a>.bottom);
00182             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Position.x = 0.0;
00183             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Position.y = 3.0;
00184             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Position.z = 5.0;
00185         <font class="keywordflow">break</font>;
00186 
00187         <font class="keywordflow">case</font> WM_SYSCOMMAND:
00188         {
00189             <font class="keywordflow">switch</font> (wParam)
00190             {
00191                 <font class="keywordflow">case</font> SC_SCREENSAVE:
00192                 <font class="keywordflow">case</font> SC_MONITORPOWER:
00193                     <font class="keywordflow">return</font> 0;
00194             }
00195             <font class="keywordflow">break</font>;
00196         }
00197 
00198         <font class="keywordflow">case</font> WM_DESTROY:
00199         <font class="keywordflow">case</font> WM_CLOSE:
00200             <font class="keyword">delete</font>[] texture;
00201             <font class="keyword">delete</font>[] polygon;
00202             <font class="keyword">delete</font>[] camera;
00203             <font class="keyword">delete</font>[] light;
00204             ChangeDisplaySettings(NULL, 0);
00205 
00206             wglMakeCurrent(<a class="code" href="main_8cpp.html#a6">hDC</a>,NULL);
00207             wglDeleteContext(<a class="code" href="main_8cpp.html#a5">hRC</a>);
00208             ReleaseDC(<a class="code" href="main_8cpp.html#a7">hWnd</a>,<a class="code" href="main_8cpp.html#a6">hDC</a>);
00209 
00210             PostQuitMessage(0);
00211         <font class="keywordflow">break</font>;
00212 
00213         <font class="keywordflow">case</font> WM_KEYDOWN:
00214             <a class="code" href="main_8cpp.html#a13">key</a>[wParam] = TRUE;
00215         <font class="keywordflow">break</font>;
00216 
00217         <font class="keywordflow">case</font> WM_KEYUP:
00218             <a class="code" href="main_8cpp.html#a13">key</a>[wParam] = FALSE;
00219         <font class="keywordflow">break</font>;
00220 
00221         <font class="keywordflow">case</font> WM_SIZE:
00222             SetCursorPos((<font class="keywordtype">int</font>)(<a class="code" href="main_8cpp.html#a8">screen</a>.right * 0.5), (<font class="keywordtype">int</font>)(<a class="code" href="main_8cpp.html#a8">screen</a>.bottom * 0.5));
00223             <a class="code" href="main_8cpp.html#a31">ReSizeGLScene</a>(LOWORD(lParam),HIWORD(lParam));
00224         <font class="keywordflow">break</font>;
00225 
00226         <font class="keywordflow">case</font> WM_MOUSEMOVE:
00227             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Delta_x = float(HIWORD(lParam) - <a class="code" href="main_8cpp.html#a8">screen</a>.bottom * 0.5) * 10;
00228             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Delta_y = <font class="keywordtype">float</font>(LOWORD(lParam) - <a class="code" href="main_8cpp.html#a8">screen</a>.right * 0.5) * 10;
00229         <font class="keywordflow">break</font>;
00230 
00231         <font class="keywordflow">case</font> WM_LBUTTONDOWN:
00232             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Delta_z = -120.0;
00233         <font class="keywordflow">break</font>;
00234 
00235         <font class="keywordflow">case</font> WM_RBUTTONDOWN:
00236             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Delta_z = 120.0;
00237         <font class="keywordflow">break</font>;
00238 
00239         <font class="keywordflow">case</font> WM_LBUTTONUP:
00240             if (wParam != MK_RBUTTON)
00241                 camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Delta_z = 0.0;
00242         <font class="keywordflow">break</font>;
00243 
00244         <font class="keywordflow">case</font> WM_RBUTTONUP:
00245             <font class="keywordflow">if</font> (wParam != MK_LBUTTON)
00246                 camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Delta_z = 0.0;
00247         <font class="keywordflow">break</font>;
00248 
00249         <font class="keywordflow">default</font>:
00250             <font class="keywordflow">return</font> (DefWindowProc(<a class="code" href="main_8cpp.html#a7">hWnd</a>, message, wParam, lParam));
00251     }
00252 
00253     <font class="keywordflow">return</font> (0);
00254 }
00255 
<a name="l00256"></a><a class="code" href="main_8cpp.html#a34">00256</a> <font class="keywordtype">int</font> WINAPI <a class="code" href="main_8cpp.html#a34">WinMain</a>( HINSTANCE    hInstance,
00257                     HINSTANCE,
00258                     LPSTR,
00259                     <font class="keywordtype">int</font>)
00260 {
00261     MSG           msg;
00262     WNDCLASSEX    wc;
00263 
00264     GetWindowRect(GetDesktopWindow(), &amp;<a class="code" href="main_8cpp.html#a8">screen</a>);
00265     wc.cbSize = <font class="keyword">sizeof</font>(WNDCLASSEX);
00266     wc.style            = CS_HREDRAW | CS_VREDRAW | CS_DBLCLKS | CS_SAVEBITS;
00267     wc.lpfnWndProc      = (WNDPROC) <a class="code" href="main_8cpp.html#a33">WndProc</a>;
00268     wc.cbClsExtra       = 0;
00269     wc.cbWndExtra       = 0;
00270     wc.hInstance        = hInstance;
00271     wc.hIcon            = LoadIcon(hInstance, MAKEINTRESOURCE(<a class="code" href="resource_8h.html#a0">IDI_MYICON</a>));
00272     wc.hIconSm          = LoadIcon(hInstance, MAKEINTRESOURCE(<a class="code" href="resource_8h.html#a0">IDI_MYICON</a>));
00273     wc.hCursor          = LoadCursor(NULL, IDC_ARROW);
00274     wc.hbrBackground    = NULL;
00275     wc.lpszMenuName     = NULL;
00276     wc.lpszClassName    = <font class="stringliteral">"OpenGL WinClass"</font>;
00277 
00278 
00279     <font class="keywordflow">if</font>(!RegisterClassEx(&amp;wc))
00280     {
00281         MessageBox(NULL,<font class="stringliteral">"Failed To Register The Window Class."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00282         <font class="keywordflow">return</font> FALSE;
00283     }
00284 
00285     <a class="code" href="main_8cpp.html#a7">hWnd</a> = CreateWindowEx(
00286     WS_EX_LEFT,
00287     <font class="stringliteral">"OpenGL WinClass"</font>,
00288     <font class="stringliteral">"OpenGL &amp; Win32 Tutorial No.24"</font>,
00289     WS_MAXIMIZE |
00290     WS_CLIPCHILDREN |
00291     WS_CLIPSIBLINGS |
00292     WS_POPUPWINDOW |
00293     WS_VISIBLE,
00294     0, 0,
00295     <a class="code" href="main_8cpp.html#a8">screen</a>.right, <a class="code" href="main_8cpp.html#a8">screen</a>.bottom,
00296     NULL,
00297     NULL,
00298     hInstance,
00299     NULL);
00300 
00301     <font class="keywordflow">if</font>(!<a class="code" href="main_8cpp.html#a7">hWnd</a>)
00302     {
00303         MessageBox(NULL,<font class="stringliteral">"Window Creation Error."</font>,<font class="stringliteral">"Error"</font>,MB_OK|MB_ICONERROR);
00304         <font class="keywordflow">return</font> FALSE;
00305     }
00306 
00307     DEVMODE dmScreenSettings;
00308 
00309     memset(&amp;dmScreenSettings, 0, <font class="keyword">sizeof</font>(DEVMODE));
00310     dmScreenSettings.dmSize        = <font class="keyword">sizeof</font>(DEVMODE);
00311     dmScreenSettings.dmPelsWidth    = <a class="code" href="main_8cpp.html#a8">screen</a>.right;
00312     dmScreenSettings.dmPelsHeight    = <a class="code" href="main_8cpp.html#a8">screen</a>.bottom;
00313     dmScreenSettings.dmFields    = DM_PELSWIDTH | DM_PELSHEIGHT;
00314     ChangeDisplaySettings(&amp;dmScreenSettings, CDS_FULLSCREEN);
00315 
00316     ShowWindow(<a class="code" href="main_8cpp.html#a7">hWnd</a>, SW_HIDE);
00317 
00318     Console-&gt;<a class="code" href="classConsoleWindow.html#a2">Open</a>();
00319     SetConsoleTitle(<font class="stringliteral">"Basic ODE Example"</font>);
00320     cout &lt;&lt; <font class="stringliteral">"Pressing the spacebar drops a new box\n\r"</font> &lt;&lt; endl;
00321     cout &lt;&lt; <font class="stringliteral">"The mouse and arrow keys control the camera\n\r"</font> &lt;&lt; endl;
00322     system(<font class="stringliteral">"PAUSE"</font>);
00323     Console-&gt;<a class="code" href="classConsoleWindow.html#a3">Close</a>();
00324 
00325     ShowWindow(<a class="code" href="main_8cpp.html#a7">hWnd</a>, SW_SHOW);
00326     UpdateWindow(<a class="code" href="main_8cpp.html#a7">hWnd</a>);
00327     SetFocus(<a class="code" href="main_8cpp.html#a7">hWnd</a>);
00328     SetCursorPos((<font class="keywordtype">int</font>)(<a class="code" href="main_8cpp.html#a8">screen</a>.right * 0.5), (<font class="keywordtype">int</font>)(<a class="code" href="main_8cpp.html#a8">screen</a>.bottom * 0.5));
00329     ShowCursor(0);
00330 
00331     <font class="keywordflow">while</font> (1)
00332     {
00333         <font class="keywordflow">while</font> (PeekMessage(&amp;msg, NULL, 0, 0, PM_NOREMOVE))
00334         {
00335             <font class="keywordflow">if</font> (GetMessage(&amp;msg, NULL, 0, 0))
00336             {
00337                 TranslateMessage(&amp;msg);
00338                 DispatchMessage(&amp;msg);
00339             }
00340             <font class="keywordflow">else</font>
00341             {
00342                 <font class="keywordflow">return</font> TRUE;
00343             }
00344         }
00345 
00346         SetCursorPos((<font class="keywordtype">int</font>)(<a class="code" href="main_8cpp.html#a8">screen</a>.right * 0.5), (<font class="keywordtype">int</font>)(<a class="code" href="main_8cpp.html#a8">screen</a>.bottom * 0.5));
00347         <a class="code" href="main_8cpp.html#a32">DrawGLScene</a>();
00348         glFlush();
00349         SwapBuffers(<a class="code" href="main_8cpp.html#a6">hDC</a>);
00350 
00351         MyTimer-&gt;<a class="code" href="classTimer.html#a2">Refresh</a>();
00352         <a class="code" href="main_8cpp.html#a19">multiplier</a> = MyTimer-&gt;<a class="code" href="classTimer.html#m2">frametime</a>;
00353         camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Multiplier = <a class="code" href="main_8cpp.html#a19">multiplier</a>;
00354         light[<a class="code" href="main_8cpp.html#a21">currentLight</a>].Multiplier = <a class="code" href="main_8cpp.html#a19">multiplier</a>;
00355 
00356         <font class="comment">// Reset the geom Object    </font>
00357         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_SPACE] &amp;&amp; <a class="code" href="main_8cpp.html#a14">released_key</a>[VK_SPACE] == 0)
00358         {
00359             dMatrix3 R;
00360             dBodySetPosition(Object.<a class="code" href="structMyObject.html#m0">Body</a>, 0, 10, -5);
00361             <a class="code" href="classVECTOR.html">VECTOR</a> tempVect(0.0, 0.0, 0.0);
00362             dBodySetLinearVel(Object.<a class="code" href="structMyObject.html#m0">Body</a>, tempVect.<a class="code" href="classVECTOR.html#m0">x</a>, tempVect.<a class="code" href="classVECTOR.html#m1">y</a>, tempVect.<a class="code" href="classVECTOR.html#m2">z</a>);
00363             dRFromAxisAndAngle(R, dRandReal() * 2.0 - 1.0, dRandReal() * 2.0 - 1.0, dRandReal() * 2.0 - 1.0, dRandReal() * 10.0 - 5.0);
00364             dBodySetRotation(Object.<a class="code" href="structMyObject.html#m0">Body</a>, R);
00365 
00366             <a class="code" href="main_8cpp.html#a14">released_key</a>[VK_SPACE] = 1;
00367         }
00368 
00369         <font class="keywordflow">if</font> (!<a class="code" href="main_8cpp.html#a13">key</a>[VK_SPACE])
00370             <a class="code" href="main_8cpp.html#a14">released_key</a>[VK_SPACE] = 0;
00371 
00372         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[49])
00373         {
00374             <a class="code" href="main_8cpp.html#a17">step</a> = 1.0;
00375         }
00376 
00377         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[50])
00378         {
00379             <a class="code" href="main_8cpp.html#a17">step</a> = 2.0;
00380         }
00381 
00382         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[51])
00383         {
00384             <a class="code" href="main_8cpp.html#a17">step</a> = 3.0;
00385         }
00386 
00387         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[52])
00388         {
00389             <a class="code" href="main_8cpp.html#a17">step</a> = 4.0;
00390         }
00391 
00392         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[53])
00393         {
00394             <a class="code" href="main_8cpp.html#a17">step</a> = 5.0;
00395         }
00396 
00397         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[54])
00398         {
00399             <a class="code" href="main_8cpp.html#a17">step</a> = 6.0;
00400         }
00401 
00402         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[55])
00403         {
00404             <a class="code" href="main_8cpp.html#a17">step</a> = 7.0;
00405         }
00406 
00407         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[56])
00408         {
00409             <a class="code" href="main_8cpp.html#a17">step</a> = 8.0;
00410         }
00411 
00412         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[57])
00413         {
00414             <a class="code" href="main_8cpp.html#a17">step</a> = 9.0;
00415         }
00416 
00417         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_RIGHT])
00418         {
00419             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Movement_x += <a class="code" href="main_8cpp.html#a17">step</a>;
00420         }
00421 
00422         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_LEFT])
00423         {
00424             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Movement_x -= <a class="code" href="main_8cpp.html#a17">step</a>;
00425         }
00426 
00427         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_DOWN])
00428         {
00429             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Movement_z += <a class="code" href="main_8cpp.html#a17">step</a>;
00430         }
00431 
00432         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_UP])
00433         {
00434             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Movement_z -= <a class="code" href="main_8cpp.html#a17">step</a>;
00435         }
00436 
00437         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_PRIOR])
00438         {
00439             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Movement_y += <a class="code" href="main_8cpp.html#a17">step</a>;
00440         }
00441 
00442         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_NEXT])
00443         {
00444             camera[<a class="code" href="main_8cpp.html#a15">currentCamera</a>].Movement_y -= <a class="code" href="main_8cpp.html#a17">step</a>;
00445         }
00446 
00447         <font class="keywordflow">if</font> (<a class="code" href="main_8cpp.html#a13">key</a>[VK_ESCAPE])
00448             SendMessage(<a class="code" href="main_8cpp.html#a7">hWnd</a>,WM_CLOSE,0,0);
00449     }
00450 }
00451 
00452 
00453 
00454                                       
00455 
00456 
</pre></div><hr><address align="right"><small>Generated on Thu Feb 9 04:21:43 2006 for Basic ODE Example by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
